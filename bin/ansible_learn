#!/usr/local/Cellar/python/2.7.13/bin/python
# coding:utf-8

from optparse import OptionParser
from lib import ansible_learn
import json

DEFAULT_HOST_LIST = '~/.ansible_hosts'
DEFAULT_MODULE_PATH = '~/.ansible'
DEFAULT_MODULE_NAME = 'ping'
DEFAULT_MODULE_ARGS = ''
DEFAULT_PATTERN = '*'
DEFAULT_REMOTE_USER = 'root'


# 执行文件参数设置
class Cli(object):

    def __init__(self):
        pass


    def runner(self):
        parser = OptionParser()
        parser.add_option("-H", "--host-list", dest="host_list",
            help="path to hosts list", default=DEFAULT_HOST_LIST)
        parser.add_option("-L", "--library", dest="module_path",
            help="path to module library", default=DEFAULT_MODULE_PATH)
        parser.add_option("-n", "--name", dest="module_name",
            help="module name to execute", default=DEFAULT_MODULE_NAME)
        parser.add_option("-u", "--remote-user", dest="remote_user",
            help="remote username", default=DEFAULT_REMOTE_USER)
        parser.add_option("-p", "--pattern", dest="pattern",
            help="hostname pattern", default=DEFAULT_PATTERN)
        parser.add_option("-a", "--args", dest="module_args",
            help="module arguments", default=DEFAULT_MODULE_ARGS)

        options, args = parser.parse_args()

        return ansible_learn.Runner(
            module_path=options.module_path,
            module_name=options.module_name,
            host_list=options.host_list,
            pattern=options.pattern,
            remote_user=options.remote_user,
            module_args=options.module_args.split(' '),
        )


if __name__ == '__main__':

    result = Cli().runner().run()
    print json.dumps(result, sort_keys=True, indent=4)

